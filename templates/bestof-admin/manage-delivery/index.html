{% extends "bestof-admin/base-template.html" %}
{% block content %}
{% load static %}
<!----------------COntent start-------------->
<section id="content-wrapper">
   <div class="container-fluid">
      <div class="row p-t-b-20">
         <div class="col-md-12">
            <div class="form-card no-b">
               <div class="login-form-card">
                  
                  <div class="add_category head-div mb-20">
                     <h3 class="add_name">Manage Delivery Partner</h3>
                     <a href="" class="add-btn"data-toggle="modal" data-target="#exampleModal"><i class="fa fa-plus mr-5"></i>Add  Partner</a>
                  </div>
                  <div class="table-responsive">
                     <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                           <tr>
                              <th>S.No</th>
                              <th>Name</th>
                              <th>Logo</th>
                              <th>Deep Link</th>
                              <th>Status</th>
                              <th>Action</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for data in delivery_partner_data %}
                           <tr>
                              <td>{{forloop.counter}}</td>
                              <td>{{data.name}}</td>
                             	<td>
                             		<img src='{{data.logo.url}}' style="border: 1px solid black; width: 200px;height: 65px;" alt="Logo">


                          		</td>
                              <td>{{data.deep_link_url}}</td>
                              <td>
                                {% if data.publish_status == True %}
                              <button partnerstatus-id="{{data.id}}" partnerstatus="{{data.publish_status}}" class=" active-btn  approve">
                              Active</button>
                              {% else %}
                              <button partnerstatus-id="{{data.id}}" partnerstatus="{{data.publish_status}}" class=" inactive-btn  approve">
                              Deactive</button>
                              {% endif %}


                              <!-- {{data.publish_status}} -->
                            </td>
                              <!--  <td><a href="" class="active-btn">Active</td> -->
                              <td >
                                 <table class="act-button">
                                    <tr>

                                    	    <td><a href="/admin/manage-delivery-partner/edit/{{data.id}}" class="btn-edit"> <button class="btn-edit edit_question_group"  title="Edit"><i class="fa fa-pencil"></i></button></a></td>


                                    	    <!-- <td><button class="btn-edit edit_logo"  title="Edit" data-toggle="modal" data-target="#edit-partner-logo" data-logo_id="{{data.id}}"><i class="fa fa-file-image-o"></i></button></td> -->

                                    	    <!-- <td>change image</td> -->


                                       <!-- <td><a href="#" class="btn-edit" title="edit" data-toggle="modal" data-target="#modal-default1"><span class="fa fa-pencil"></span></a></td> -->

                                       <!--   <td ><a href="#" title="Edit" class="btn-edit"><span class="fa fa-pencil"></span></a></td> -->
                                       <td><a href="#" class="btn-delete" title="Delete" data-toggle="modal" data-target="#modal-default2" id="data-manage-delivery" data-manage-delivery_id="{{data.id}}"><span class="fa fa-trash"></span></a></td>
                                    </tr>
                                 </table>
                              </td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <!-- edit modal----->
   <div class="modal fade in sp-map" id="edit-partner">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title">Edit</h4>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true" style="font-size: 32px;">×</span>
               </button>
            </div>
            <div class="modal-body">
               <div class="paper">
                  <div class="row">
                     <div class="col-md-12">
                        <div class="container-fluid">

<!--                            <form>
                              <div class="form-group">
                                 <label for="Bussiness Id">Name</label>
                                 <input type="text" class="form-control" id="Bussiness Id" placeholder="Enter Business Id">
                              </div>
                              <div class="form-group">
                                 <label for="Bussiness Name">Deep Link</label>
                                 <input type="text" class="form-control" id="Bussiness Name" placeholder="Enter Business Name">
                              </div>
                              <div class="form-group">
                                 <label for="Delivery Partner">Logo</label>
                                 <select class="form-control" id="Delivery Partner">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                 </select>
                              </div>
                              <center><button type="btn" class="btn btn-dark">Submit</button></center>
                           </form> -->
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>

<!-- Modal --------------------------------------------->   <!-- edit modal----->
   <div class="modal fade in sp-map" id="edit-partner-logo">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title">Edit Logo</h4>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true" style="font-size: 32px;">×</span>
               </button>
            </div>
            <div class="modal-body">
               <div class="paper">
                  <div class="row">
                     <div class="col-md-12">
                        <div class="container-fluid">

<!--                            <form>
                              <div class="form-group">
                                 <label for="Bussiness Id">Name</label>
                                 <input type="text" class="form-control" id="Bussiness Id" placeholder="Enter Business Id">
                              </div>
                              <div class="form-group">
                                 <label for="Bussiness Name">Deep Link</label>
                                 <input type="text" class="form-control" id="Bussiness Name" placeholder="Enter Business Name">
                              </div>
                              <div class="form-group">
                                 <label for="Delivery Partner">Logo</label>
                                 <select class="form-control" id="Delivery Partner">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                 </select>
                              </div>
                              <center><button type="btn" class="btn btn-dark">Submit</button></center>
                           </form> -->
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>

<!-- Modal --------------------------------------------->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add Partner</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="#" method="post">
          {% csrf_token %}
  <div class="form-group">
    <label>Name</label>
    {{delivery_partner_form.name}}
    <!-- <input type="name" class="form-control" id="name" aria-describedby="" placeholder="Enter name"> -->
    
  </div>
  <div class="form-group">
    <label>link</label>
    {{delivery_partner_form.deep_link_url}}
    <!-- <input type="text" class="form-control" id="" placeholder="link"> -->
  </div>
    <!-- <div class="form-group">
    <label for="exampleFormControlFile1">Logo</label>

    <div class="col-md-4 col-xs-12 box-img-currentProf">
                        <div class="icon-camera">
                            <i class="mdi mdi-camera"></i>
                        </div>
                        <img src='{% static "bestof-admin/images/icons/logo-dummy.png" %}' onclick="profile_change();" class="user-image" style="border: 1px solid black; width: 155px;height: 91px;" alt="Logo">
                        <input type="file" id="project_map_value" name="user_profile_photo" style="width: 100%; opacity: 0; position: absolute; top: 0px; overflow: hidden; height: 90px;" />                                   
                    </div>

  </div> -->
  <button type="submit" class="btn btn-primary">Submit</button>
</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        
      </div>
    </div>
  </div>
</div>
<!------------------------------------------------------------>
   <!------------Delete messege Modal Popup Start------->
   <div class="modal fade in sp-map" id="modal-default2">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <h4 class="modal-title">Confirm</h4>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true" style="font-size: 32px;">×</span>
               </button>
            </div>
            <div class="modal-body">
               <div class="paper">
                  <div class="row">
                     <div class="col-md-12">
                        <div class="container-fluid">
                          <form action="{% url 'manage_delivery_partner_link:DeliveryPartnerDeleteView' %}" method="POST">
                              {% csrf_token %}
                                 <input type="hidden"  class="id_log" value="" name="id_log">

                              <div class="row">
                                 <p>Are you sure you want to Delete?</p>
                                 <div class="col-md-6">
                                    <button type="submit" class="buttons-action btn-block" >Yes</button>
                                 </div>
                                 <div class="col-md-6">
                                    <div class="form-group">
                                       <button type="submit" class="buttons-action btn-block" data-dismiss="modal">Cancel</button>
                                    </div>
                                 </div>
                              </div>
                           </form>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <!--------------------Delete Message Modal Ends---------------->
   <!-- User profile croper modal start -->
<div id="uploadimageModal_edit" class="modal" role="dialog">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <h4 class="modal-title text-center">Upload & Crop Image</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
         </div>
         <div class="modal-body">
            <div class="row">
               <div class="col-md-8 text-center">
                  <div id="image_demo_edit" style="height: auto;"></div>
               </div>
            </div>
         </div>
         <div class="modal-footer">
            <div class="row">
               <div class="col-md-6" style="float: left;">
                  <div class="set_loader"></div>
                  <button class="btn btn-success crop_image_edit" style="float: left;">Crop Image</button>
               </div>
               <div class="col-md-6"> 
                  <button type="button" style="float: right;" class="btn btn-default" data-dismiss="modal">Close</button>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
</section>

{% endblock %}
{% block script %}
<script type="text/javascript">

$(document).on("click",".edit_question_group",function(){
var id = $(this).data("group_id");
$.ajax({
  method:"GET",
  url :"/admin/manage-delivery-partner/edit/"+id,
  dataType:"html",

  success:function(data)
  {
     $("#edit-partner .modal-body").html(data);
  }
});
});
</script>
<script type="text/javascript">

$(document).on("click",".edit_logo",function(){
var id = $(this).data("logo_id");
$.ajax({
  method:"GET",
  url :"/admin/manage-delivery-partner/edit-logo/"+id,
  dataType:"html",

  success:function(data)
  {
     $("#edit-partner-logo .modal-body").html(data);
  }
});
});


// <!--for delete-->
 var token = '{{csrf_token}}';
 $(document).on("click","#data-manage-delivery",function(){
  var delete_value = $(this).data("manage-delivery_id");
// <!--  document.write(delete_value )-->
  $('.id_log').val(delete_value);
});
// <!--delete end-->

// --------------------------------------------------------------------
    //---------Block and Unblock User Start----------------
         $(document).on('click', ".approve", function (e) {
         var partnerstatusid = $(e.currentTarget).attr("partnerstatus-id");
         var partnerstatus = $(e.currentTarget).attr('partnerstatus');
         console.log(partnerstatusid);
         console.log(partnerstatus);
         if(partnerstatus == 'True'){
         varstatus = 'Deactive';
         }
         else{
         varstatus = 'Active';
         }
         swal({
          title: 'Are you sure?',
          text: varstatus+' this',
          icon: 'warning',
          buttons: {
            cancel: {
              text: "Cancel",
              value: null,
              visible: true,
              closeModal: true,
            },
            confirm: {
              text: "OK",
              value: true,
              visible: true,
              closeModal: true
            },
          }
         }).then(function (willBlock){
         if (willBlock) {
          var dataString = 'partnerstatusid='+partnerstatusid+'&partnerstatus='+partnerstatus;
                   var token = '{{csrf_token}}';
                   var geturl = window.location.href;
                   var url_in_array = geturl.split("/");
                   var set_url = url_in_array[2]; 
                   
                   $.ajax({  
                           method:"POST",
                           headers: { "X-CSRFToken": token },
                           url: "http://"+set_url+"/admin/manage-delivery-partner/delivery-status",
         
              data: dataString,
              dataType:"json",
              cache: false,
              success: function(userresponse)
              {
                if (userresponse) {
                    swal({
                          title: 'successfully!',
                          text: 'Update',
                          icon: 'success',
                           button: "Ok"
                        }).then(function() {
                          location.reload();
                       });
                }else{
                  swal({
                            text: 'Update failed',
                             icon:'error',
                            button: {
                              text: "OK",
                              value: true,
                              visible: true,
                              className: "btn btn-primary"
                            }
                          });
                }
                
              },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                    }
                    swal({
                      text: msg,
                      icon:'error',
                      button: {
                        text: "OK",
                        value: true,
                        visible: true,
                        className: "btn btn-primary"
                      }
                    });
                },
            });
         } 
         });
         }); 
         //---------Block and Unblock User End----------------
             function remove_product(urls,message,done,fail)
         {
         swal({
            title: message,
            icon: "warning",
            buttons: true,
            dangerMode: true,
          })
          .then((willDelete) => {
            if (willDelete) {
             window.location.href = urls;           
            } else {
              // swal(fail);
            }
          });
         }  
              
// --------------------------------------------------------------------
</script>
{% endblock %}